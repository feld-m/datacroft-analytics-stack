version: "3.9"

services:
  postgres-warehouse:
    image: "postgres:15.0-bullseye"
    container_name: postgres-warehouse
    ports:
      - "5432:5432"
    env_file:
      - ./postgres/config/.env-postgres
    volumes:
      - warehouse-volume:/var/lib/postgresql/data

  dbt:
    image: "ghcr.io/dbt-labs/dbt-postgres:1.3.latest"
    container_name: dbt
    volumes:
      - .:/usr/app
      - ./dbt/config/profiles.yml:/root/.dbt/profiles.yml
    command: [ "init" ]
    depends_on:
      - postgres-warehouse

  metabase:
    image: "metabase/metabase:v0.44.5"
    container_name: metabase
    ports:
      - "3000:3000"

volumes:
  warehouse-volume:
